<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo CMS Live - Th·∫•y ngay s·ª± thay ƒë·ªïi</title>
    <link rel="stylesheet" href="cms-styles.css">
    <style>
        .split-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .panel {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .panel-header {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 700;
        }

        .news-item {
            padding: 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .news-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #1e40af;
        }

        .news-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #0f172a;
        }

        .news-meta {
            font-size: 12px;
            color: #64748b;
            display: flex;
            gap: 16px;
        }

        .badge-live {
            display: inline-block;
            padding: 4px 12px;
            background: #16a34a;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .instruction {
            background: #f0f9ff;
            border-left: 4px solid #1e40af;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .instruction h4 {
            color: #1e40af;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé¨ Demo CMS Live - Th·∫•y ngay s·ª± thay ƒë·ªïi d·ªØ li·ªáu</h1>
        <p>
            <span class="status-indicator" id="serverStatus"></span>
            <span id="serverStatusText">ƒêang ki·ªÉm tra...</span>
        </p>
    </div>

    <div class="instruction" style="max-width: 1600px; margin: 20px auto;">
        <h4>üìã H∆∞·ªõng d·∫´n:</h4>
        <ol style="margin: 8px 0 0 20px; line-height: 1.8;">
            <li><strong>B√™n tr√°i:</strong> CMS - T·∫°o/S·ª≠a/X√≥a b√†i vi·∫øt</li>
            <li><strong>B√™n ph·∫£i:</strong> Tin t·ª©c - Xem b√†i vi·∫øt ƒë√£ xu·∫•t b·∫£n</li>
            <li><strong>Test:</strong> T·∫°o b√†i m·ªõi b√™n tr√°i ‚Üí Th·∫•y ngay b√™n ph·∫£i!</li>
        </ol>
    </div>

    <div class="split-view">
        <!-- LEFT: CMS Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">‚öôÔ∏è CMS - Qu·∫£n l√Ω B√†i vi·∫øt</div>
                <span class="badge-live">üî¥ LIVE</span>
            </div>

            <button class="btn btn-primary" onclick="openCreateModal()" style="margin-bottom: 20px; width: 100%;">
                ‚ûï T·∫°o b√†i vi·∫øt m·ªõi
            </button>

            <div id="cmsPostsList"></div>
        </div>

        <!-- RIGHT: News Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">üì∞ Tin t·ª©c - B√†i vi·∫øt ƒë√£ xu·∫•t b·∫£n</div>
                <button class="btn btn-sm" onclick="refreshNews()" style="background: white; color: #1e40af; padding: 6px 12px;">
                    üîÑ Refresh
                </button>
            </div>

            <div id="newsPublishedList"></div>
        </div>
    </div>

    <!-- Create Post Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">‚úçÔ∏è T·∫°o b√†i vi·∫øt m·ªõi</h2>
                <span class="modal-close" onclick="closeCreateModal()">&times;</span>
            </div>

            <form id="postForm" onsubmit="handleSubmit(event)">
                <div class="form-group">
                    <label class="form-label">Ti√™u ƒë·ªÅ *</label>
                    <input type="text" name="title" class="form-control" required>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Danh m·ª•c *</label>
                        <select name="category" class="form-control" required>
                            <option value="news">üì∞ Tin t·ª©c</option>
                            <option value="event">üè≠ S·ª± ki·ªán</option>
                            <option value="policy">üéÅ Ch√≠nh s√°ch</option>
                            <option value="report">‚ö° B√°o c√°o</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tr·∫°ng th√°i</label>
                        <select name="status" class="form-control">
                            <option value="draft">üìù Nh√°p</option>
                            <option value="published">‚úì Xu·∫•t b·∫£n ngay</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">N·ªôi dung *</label>
                    <textarea name="content" class="form-control" rows="6" required></textarea>
                </div>

                <div style="display: flex; gap: 12px;">
                    <button type="submit" class="btn btn-primary">üíæ L∆∞u</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <script src="api-client.js"></script>
    <script>
        let editingId = null;

        // Check server
        async function checkServer() {
            const indicator = document.getElementById('serverStatus');
            const text = document.getElementById('serverStatusText');
            try {
                await fetch('http://localhost:3001/api/posts');
                indicator.className = 'status-indicator online';
                text.textContent = 'Server ƒëang ch·∫°y - http://localhost:3001';
            } catch {
                indicator.className = 'status-indicator offline';
                text.textContent = 'Server ch∆∞a ch·∫°y - Ch·∫°y: npm start';
            }
        }

        // Load CMS posts
        async function loadCMSPosts() {
            try {
                const response = await api.getPosts();
                const posts = response.data;
                
                const container = document.getElementById('cmsPostsList');
                if (posts.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">Ch∆∞a c√≥ b√†i vi·∫øt n√†o</p>';
                    return;
                }

                container.innerHTML = posts.map(post => `
                    <div class="news-item">
                        <div class="news-title">${post.title}</div>
                        <div class="news-meta">
                            <span>üìÅ ${getCategoryName(post.category)}</span>
                            <span>${getStatusBadge(post.status)}</span>
                            <span>üìÖ ${formatDate(post.createdAt)}</span>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px;">
                            <button class="btn btn-sm btn-primary" onclick="editPost('${post.id}')">‚úèÔ∏è S·ª≠a</button>
                            ${post.status === 'draft' ? `<button class="btn btn-sm btn-success" onclick="publishPost('${post.id}')">üì§ Xu·∫•t b·∫£n</button>` : ''}
                            <button class="btn btn-sm btn-danger" onclick="deletePost('${post.id}')">üóëÔ∏è X√≥a</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('cmsPostsList').innerHTML = '<p style="color: #dc2626;">L·ªói: ' + error.message + '</p>';
            }
        }

        // Load published posts for News
        async function loadPublishedPosts() {
            try {
                const response = await api.getPosts('published');
                const posts = response.data;
                
                const container = document.getElementById('newsPublishedList');
                if (posts.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">Ch∆∞a c√≥ b√†i vi·∫øt ƒë√£ xu·∫•t b·∫£n</p>';
                    return;
                }

                container.innerHTML = posts.map(post => `
                    <div class="news-item" style="border-left: 4px solid #16a34a;">
                        <div class="news-title">${post.title}</div>
                        <div style="color: #64748b; font-size: 14px; margin: 8px 0;">
                            ${post.content.substring(0, 150)}...
                        </div>
                        <div class="news-meta">
                            <span>üìÅ ${getCategoryName(post.category)}</span>
                            <span>üìÖ ${formatDate(post.createdAt)}</span>
                            <span>üëÅÔ∏è ${Math.floor(Math.random() * 2000)} views</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('newsPublishedList').innerHTML = '<p style="color: #dc2626;">L·ªói: ' + error.message + '</p>';
            }
        }

        // Create/Edit
        function openCreateModal() {
            editingId = null;
            document.getElementById('modalTitle').textContent = '‚úçÔ∏è T·∫°o b√†i vi·∫øt m·ªõi';
            document.getElementById('postForm').reset();
            document.getElementById('createModal').classList.add('active');
        }

        async function editPost(id) {
            try {
                const response = await api.getPost(id);
                const post = response.data;
                
                editingId = id;
                document.getElementById('modalTitle').textContent = '‚úèÔ∏è S·ª≠a b√†i vi·∫øt';
                
                const form = document.getElementById('postForm');
                form.title.value = post.title;
                form.category.value = post.category;
                form.content.value = post.content;
                form.status.value = post.status;
                
                document.getElementById('createModal').classList.add('active');
            } catch (error) {
                alert('L·ªói: ' + error.message);
            }
        }

        function closeCreateModal() {
            document.getElementById('createModal').classList.remove('active');
            editingId = null;
        }

        async function handleSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = {
                title: formData.get('title'),
                category: formData.get('category'),
                content: formData.get('content'),
                author: 'Admin',
                status: formData.get('status')
            };

            try {
                if (editingId) {
                    await api.updatePost(editingId, data);
                    showToast('success', '‚úÖ ƒê√£ c·∫≠p nh·∫≠t b√†i vi·∫øt!');
                } else {
                    await api.createPost(data);
                    showToast('success', '‚úÖ ƒê√£ t·∫°o b√†i vi·∫øt m·ªõi!');
                }

                closeCreateModal();
                await loadCMSPosts();
                await loadPublishedPosts();
            } catch (error) {
                showToast('error', 'L·ªói: ' + error.message);
            }
        }

        // Delete
        async function deletePost(id) {
            if (!confirm('X√≥a b√†i vi·∫øt n√†y?')) return;

            try {
                await api.deletePost(id);
                showToast('success', '‚úÖ ƒê√£ x√≥a!');
                await loadCMSPosts();
                await loadPublishedPosts();
            } catch (error) {
                showToast('error', 'L·ªói: ' + error.message);
            }
        }

        // Publish
        async function publishPost(id) {
            if (!confirm('Xu·∫•t b·∫£n b√†i vi·∫øt n√†y?')) return;

            try {
                await api.publishPost(id);
                showToast('success', '‚úÖ ƒê√£ xu·∫•t b·∫£n!');
                await loadCMSPosts();
                await loadPublishedPosts();
            } catch (error) {
                showToast('error', 'L·ªói: ' + error.message);
            }
        }

        // Refresh
        async function refreshNews() {
            showToast('success', 'üîÑ ƒêang refresh...');
            await loadPublishedPosts();
        }

        // Helpers
        function getCategoryName(cat) {
            const names = {news: 'Tin t·ª©c', event: 'S·ª± ki·ªán', policy: 'Ch√≠nh s√°ch', report: 'B√°o c√°o'};
            return names[cat] || cat;
        }

        function getStatusBadge(status) {
            const badges = {
                published: '<span class="badge badge-success">‚úì ƒê√£ xu·∫•t b·∫£n</span>',
                draft: '<span class="badge badge-secondary">üìù Nh√°p</span>',
                pending: '<span class="badge badge-warning">‚è≥ Ch·ªù duy·ªát</span>'
            };
            return badges[status] || status;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('vi-VN');
        }

        function showToast(type, message) {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úì' : '‚ö†Ô∏è'}</span><div>${message}</div>`;
            toast.style.position = 'fixed';
            toast.style.top = '20px';
            toast.style.right = '20px';
            toast.style.zIndex = '10000';
            toast.style.minWidth = '300px';
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await checkServer();
            await loadCMSPosts();
            await loadPublishedPosts();
            
            setInterval(checkServer, 5000);
        });

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
